<!-- Tarifs_Section.html — section tarifs dynamique liée à Configuration.gs -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --violet:#8e44ad;     /* principal/boutons */
    --bleu:#3498db;       /* actions/jours */
    --bleuC:#5dade2;      /* options spéciales */
    --txt:#1f2d3d; --txt-soft:#6b7b8c;
  }
  .tarifs-wrap{font-family:'Montserrat',sans-serif;color:var(--txt);
    background:linear-gradient(135deg,var(--violet) 0%,var(--bleu) 100%);
    border-radius:24px;padding:clamp(16px,3vw,28px);box-shadow:0 10px 24px rgba(0,0,0,.12)}
  .tarifs-inner{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2);
    border-radius:20px;padding:clamp(16px,2.5vw,24px)}
  .tarifs-title{font-weight:700;font-size:clamp(20px,2.4vw,28px);color:#fff;text-align:center;margin:4px 0 6px}
  .tarifs-sub{text-align:center;color:rgba(255,255,255,.9);font-size:clamp(12px,1.6vw,14px);margin-bottom:18px}
  .cards{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:clamp(12px,2vw,20px)}
  @media (max-width:920px){.cards{grid-template-columns:1fr}}
  .card{background:rgba(255,255,255,.92);border-radius:16px;padding:clamp(14px,2vw,18px);box-shadow:0 6px 16px rgba(0,0,0,.08);transition:.2s}
  .card:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(0,0,0,.12)}
  .card h3{margin:0 0 10px;font-size:clamp(16px,2vw,18px);color:var(--txt)}
  .bullet{display:grid;gap:6px;font-size:14px;line-height:1.45;min-height:72px}
  .cta{margin-top:18px;display:inline-block;padding:10px 18px;border-radius:999px;
    background:linear-gradient(90deg,var(--violet),var(--bleu));color:#fff;font-weight:700;text-decoration:none;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.25),0 8px 16px rgba(0,0,0,.15)}
  .cta:hover{filter:brightness(1.02)}
  .footer{color:#fff;text-align:center;margin-top:14px;font-size:13px}
  .footer a{color:#fff;text-underline-offset:2px}
  .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:rgba(255,255,255,.16);color:#fff;font-size:12px;margin-top:6px}
  .opt-note{color:var(--txt-soft);font-size:13px}
  .opt-highlight{color:var(--bleu);font-weight:700}
  .opt-special{color:var(--bleuC);font-weight:700}
</style>

<section class="tarifs-wrap" aria-labelledby="tarifs-title">
  <div class="tarifs-inner">
    <h2 id="tarifs-title" class="tarifs-title">Chargement des tarifs…</h2>
    <p class="tarifs-sub" id="tarifs-sub">Lecture de la configuration</p>

    <div class="cards" role="list">
      <article class="card" role="listitem" aria-labelledby="card-base-title">
        <h3 id="card-base-title">Course de base</h3>
        <div class="bullet" id="card-base-content"><small>—</small></div>
        <a href="#" class="cta" id="cta-reserver" aria-label="Réserver une tournée">Réserver</a>
      </article>

      <article class="card" role="listitem" aria-labelledby="card-arrets-title">
        <h3 id="card-arrets-title">Arrêts supplémentaires</h3>
        <div class="bullet" id="card-arrets-content"><small>—</small></div>
      </article>

      <article class="card" role="listitem" aria-labelledby="card-options-title">
        <h3 id="card-options-title">Options</h3>
        <div class="bullet" id="card-options-content"><small>—</small></div>
        <p class="opt-note">( <span class="opt-highlight">selon dispo</span> si précisé )</p>
      </article>
    </div>

    <div class="footer" id="tarifs-footer">
        <p id="same-day-info"></p>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const cards = {
    base: document.getElementById('card-base-content'),
    arrets: document.getElementById('card-arrets-content'),
    options: document.getElementById('card-options-content'),
    reserverBtn: document.querySelector('#cta-reserver')
  };

  function showInvalid(errors) {
    const msg = (errors && errors.length) ? errors.join(' · ') : "Config vide ou invalide";
    [cards.base, cards.arrets, cards.options].forEach(el => { if (el) el.textContent = msg; });
    if (cards.reserverBtn) cards.reserverBtn.disabled = true;
  }

  function renderTarifs(t) {
    if (!t) return showInvalid();
    if (cards.base)   cards.base.textContent =
      `Course de base : ${t.base} ${t.devise}`;
    if (cards.arrets) cards.arrets.textContent =
      `Arrêts sup. 1–${t.arrets.palier_max_inclus}: +${t.arrets.prix_palier} · 5+: +${t.arrets.prix_apres} ${t.devise}`;
    if (cards.options) cards.options.textContent =
      `Urgence: ${t.options.urgence.actif ? "+"+t.options.urgence.surcharge+"€ (<"+t.options.urgence.delai_minutes+" min)" : "non"} · Samedi: ${t.options.samedi.actif ? "+"+t.options.samedi.surcharge+"€" : "non"}`;

    if (cards.reserverBtn) {
      cards.reserverBtn.disabled = false;
      cards.reserverBtn.onclick = () => ouvrirModaleReservation(); // ta fonction existante
    }
  }

  // Chargement tarifs
  google.script.run
    .withSuccessHandler((res) => {
      if (!res || !res.ok) return showInvalid(res && res.errors);
      renderTarifs(res.tarifs);
    })
    .withFailureHandler(err => showInvalid([String(err)]))
    .getTarifsPublic();

  // Indication "jour même"
  google.script.run
    .withSuccessHandler((r) => {
      const el = document.querySelector('#same-day-info');
      if (!el || !r || !r.ok) return;
      el.textContent = r.allowed ? "Jour même possible" : "Jour même indisponible (délai insuffisant)";
    })
    .canBookSameDayPublic();
});
</script>
